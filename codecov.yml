# =============================================================================
# Codecov Configuration
# https://docs.codecov.com/docs/codecov-yaml
# =============================================================================

codecov:
  require_ci_to_pass: true
  notify:
    after_n_builds: 1 # Single CI job, notify after first build

# =============================================================================
# Coverage Configuration
# =============================================================================
coverage:
  precision: 2
  round: down
  range: "65...100" # Lower bound matches vitest branches threshold (65%)

  # ---------------------------------------------------------------------------
  # Status Checks
  # These appear as GitHub status checks on PRs
  # ---------------------------------------------------------------------------
  status:
    project:
      default:
        target: 78% # Match vitest threshold
        threshold: 2% # Allow 2% drop without failing
        base: auto
        if_ci_failed: error
    patch:
      default:
        target: 75% # New code should be well-tested
        threshold: 5% # More lenient for patches
        base: auto

  # ---------------------------------------------------------------------------
  # Ignore Patterns
  # These files are excluded from coverage calculation
  # ---------------------------------------------------------------------------
  ignore:
    - "src/types/**" # Type definitions only
    - "src/index.ts" # CLI entry point
    - "src/**/index.ts" # Re-export modules
    - "**/*.d.ts" # TypeScript declaration files

# =============================================================================
# PR Comments
# Configure how coverage is displayed in PR comments
# =============================================================================
comment:
  layout: "header, diff, footer"
  behavior: default
  require_changes: true # Only comment if coverage changes
  require_base: true # Require base report for comparison
  require_head: true # Require head report

# =============================================================================
# Parsers
# File parsing configuration
# =============================================================================
parsers:
  gcov:
    branch_detection:
      conditional: true
      loop: true
      macro: false
      method: false
